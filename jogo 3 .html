<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silk RPG - Carpa Grande</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=MedievalSharp&display=swap');

        body {
            font-family: 'Cinzel', serif;
            background-color: #0a0a0a;
            color: #e2e2e2;
            overflow-x: hidden;
        }

        .game-container {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23101010"/><path d="M0,0 L100,100 M100,0 L0,100" stroke="%231a1a1a" stroke-width="0.5"/></svg>');
            background-size: 100px 100px;
        }

        .character {
            transition: all 0.3s ease;
        }

        .character:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.7));
        }

        .location {
            background: rgba(10, 10, 10, 0.8);
            border: 1px solid #333;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        }

        .dialog-box {
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid #444;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
        }

        .health-bar {
            height: 6px;
            background: linear-gradient(to right, #7f1d1d, #dc2626);
        }

        .sanity-bar {
            height: 6px;
            background: linear-gradient(to right, #1e3a8a, #3b82f6);
        }

        .enemy {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .fog {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(50, 50, 50, 0.2);
            pointer-events: none;
            animation: fog-move 30s infinite linear;
        }

        @keyframes fog-move {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 100% 100%;
            }
        }

        .map-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 5px;
        }

        .map-tile {
            aspect-ratio: 1;
            background: #1a1a1a;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .map-tile:hover {
            background: #2a2a2a;
        }

        .map-tile.active {
            background: #3a3a3a;
            border-color: #666;
        }

        .map-tile.visited {
            background: #222;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">
    <div class="game-container flex-grow relative overflow-hidden">
        <!-- Fog effect -->
        <div class="fog"></div>

        <!-- Game header -->
        <header
            class="bg-black bg-opacity-80 p-4 border-b border-gray-800 flex justify-between items-center z-10 relative">
            <h1 class="text-2xl font-bold text-red-600">SILK RPG: Carpa Grande</h1>
            <div class="flex space-x-4">
                <div class="flex items-center space-x-2">
                    <span class="text-sm">Sanidade:</span>
                    <div class="w-24 h-2 bg-gray-700 rounded-full overflow-hidden">
                        <div id="sanity-bar" class="sanity-bar rounded-full" style="width: 100%"></div>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-sm">Vida:</span>
                    <div class="w-24 h-2 bg-gray-700 rounded-full overflow-hidden">
                        <div id="health-bar" class="health-bar rounded-full" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main game area -->
        <div class="flex flex-col md:flex-row h-full">
            <!-- Map section -->
            <div class="w-full md:w-1/4 bg-black bg-opacity-70 p-4 border-r border-gray-800">
                <h2 class="text-xl font-bold mb-4 text-center">Mapa de Carpa Grande</h2>
                <div class="map-grid">
                    <!-- Map tiles will be generated by JavaScript -->
                </div>
                <div class="mt-4">
                    <h3 class="font-bold mb-2">Locais Visitados:</h3>
                    <ul id="visited-locations" class="space-y-1 text-sm">
                        <!-- Visited locations will appear here -->
                    </ul>
                </div>
            </div>

            <!-- Game view section -->
            <div class="w-full md:w-3/4 p-4 relative flex flex-col">
                <!-- Scene display -->
                <div id="scene-display"
                    class="flex-grow bg-black bg-opacity-50 rounded-lg p-4 mb-4 border border-gray-700 overflow-y-auto">
                    <div id="scene-content" class="space-y-4">
                        <h2 class="text-2xl font-bold text-center">Cena 1 – Chegada à Cidade</h2>
                        <p class="text-justify">A van preta da SILK atravessa a última curva da estrada de terra, o
                            motor ronronando baixo, enquanto a névoa rasteira começa a se espalhar pelos campos e pelo
                            mato. O céu está tingido de um cinza opaco, como se a luz do crepúsculo estivesse sendo
                            engolida pelo tempo.</p>
                        <p class="text-justify">À medida que o veículo se aproxima, a cidade surge tímida, como um
                            segredo mal guardado. Carpa Grande parece uma relíquia esquecida, onde o tempo não passa
                            direito. As casas rangem ao vento, e as janelas são olhos opacos que observam, mas não
                            refletem a luz.</p>

                        <div class="bg-gray-900 p-4 rounded-lg mt-4">
                            <h3 class="font-bold text-yellow-400">Sons e cheiros</h3>
                            <p>Um silêncio quase absoluto domina a rua principal — nem mesmo o canto dos grilos se faz
                                ouvir.</p>
                            <p>O ar tem um cheiro forte de terra molhada, misturado com um odor metálico, quase de
                                sangue oxidado.</p>
                            <p>De vez em quando, um uivo baixo corta o ar, distante, mas suficiente para arrepiar a
                                espinha.</p>
                        </div>

                        <div class="flex justify-center mt-6">
                            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='400' height='200' viewBox='0 0 400 200'><rect width='400' height='200' fill='%231a1a1a'/><path d='M50,150 L100,120 L150,140 L200,110 L250,130 L300,100 L350,150' stroke='%23666' fill='none' stroke-width='2'/><rect x='70' y='120' width='30' height='30' fill='%23333'/><rect x='170' y='90' width='30' height='50' fill='%23333'/><rect x='270' y='70' width='30' height='80' fill='%23333'/><circle cx='200' cy='50' r='20' fill='%23fff' opacity='0.2'/><path d='M50,30 L100,10 L150,40 L200,20 L250,50 L300,30 L350,60' stroke='%23666' fill='none' stroke-width='1' stroke-dasharray='5,5'/></svg>"
                                alt="Carpa Grande" class="rounded-lg border border-gray-700">
                        </div>
                    </div>
                </div>

                <!-- Character and interaction area -->
                <div class="bg-black bg-opacity-70 rounded-lg p-4 border border-gray-700">
                    <div class="flex flex-wrap justify-center gap-4 mb-4" id="character-display">
                        <!-- Characters will appear here -->
                    </div>

                    <div id="action-buttons" class="flex flex-wrap gap-2 justify-center">
                        <button class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition"
                            onclick="showPerceptionTest()">Teste de Percepção</button>
                        <button class="bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition"
                            onclick="continueStory()">Continuar</button>
                    </div>

                    <div id="dialog-options" class="hidden mt-4 space-y-2">
                        <!-- Dialog options will appear here -->
                    </div>

                    <div id="dice-roll" class="hidden mt-4 p-4 bg-gray-900 rounded-lg text-center">
                        <div class="flex justify-center items-center space-x-4">
                            <div id="dice"
                                class="w-16 h-16 bg-white rounded-lg flex items-center justify-center text-2xl font-bold text-black">
                                ?</div>
                            <button onclick="rollDice()"
                                class="bg-red-800 hover:bg-red-700 text-white px-4 py-2 rounded transition">Rolar
                                Dado</button>
                        </div>
                        <p id="roll-result" class="mt-2"></p>
                        <button id="continue-after-roll"
                            class="hidden mt-4 bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition"
                            onclick="processRollResult()">Continuar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory modal -->
    <div id="inventory-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 rounded-lg p-6 max-w-md w-full border border-gray-700 max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Inventário</h3>
                <button onclick="toggleInventory()" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <div id="inventory-items" class="space-y-2">
                <!-- Inventory items will appear here -->
            </div>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            currentScene: 1,
            health: 100,
            maxHealth: 100,
            sanity: 100,
            maxSanity: 100,
            inventory: [],
            visitedLocations: [],
            testInProgress: false,
            currentTest: null,
            diceRoll: 0,
            characters: [
                {
                    id: 1,
                    name: "VV",
                    description: "Você, o investigador da SILK",
                    image: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23222'/><circle cx='50' cy='40' r='20' fill='%23333'/><rect x='30' y='70' width='40' height='20' fill='%23333'/><line x1='30' y1='70' x2='50' y2='50' stroke='%23333' stroke-width='3'/><line x1='70' y1='70' x2='50' y2='50' stroke='%23333' stroke-width='3'/></svg>"
                },
                {
                    id: 2,
                    name: "Cristofer",
                    description: "Agente da SILK, impaciente e direto",
                    image: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23333'/><circle cx='50' cy='40' r='20' fill='%23444'/><rect x='30' y='70' width='40' height='20' fill='%23444'/><line x1='30' y1='70' x2='40' y2='50' stroke='%23444' stroke-width='3'/><line x1='70' y1='70' x2='60' y2='50' stroke='%23444' stroke-width='3'/></svg>"
                },
                {
                    id: 3,
                    name: "Kaizer",
                    description: "Agente da SILK, calmo e analítico",
                    image: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23111'/><circle cx='50' cy='40' r='20' fill='%23222'/><rect x='30' y='70' width='40' height='20' fill='%23222'/><line x1='30' y1='70' x2='45' y2='55' stroke='%23222' stroke-width='3'/><line x1='70' y1='70' x2='55' y2='55' stroke='%23222' stroke-width='3'/></svg>"
                }
            ],
            npcs: [
                {
                    id: 1,
                    name: "Mirela",
                    description: "Dona do Carpa Transportes",
                    image: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23222'/><circle cx='50' cy='35' r='20' fill='%23333'/><path d='M30,70 Q50,90 70,70' fill='%23333'/><line x1='50' y1='55' x2='50' y2='65' stroke='%23333' stroke-width='2'/></svg>",
                    location: 2
                },
                {
                    id: 2,
                    name: "Dona Iraci",
                    description: "Avó do menino desaparecido",
                    image: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23222'/><circle cx='50' cy='35' r='20' fill='%23333'/><path d='M30,70 Q50,90 70,70' fill='%23333'/><line x1='50' y1='55' x2='50' y2='65' stroke='%23333' stroke-width='2'/><line x1='40' y1='30' x2='30' y2='20' stroke='%23333' stroke-width='2'/><line x1='60' y1='30' x2='70' y2='20' stroke='%23333' stroke-width='2'/></svg>",
                    location: 3
                }
            ],
            locations: [
                { id: 1, name: "Entrada da Cidade", visited: true },
                { id: 2, name: "Carpa Transportes", visited: false },
                { id: 3, name: "Casa de Dona Iraci", visited: false },
                { id: 4, name: "Casa da Colina", visited: false },
                { id: 5, name: "Orfanato Limoeiro Podre", visited: false },
                { id: 6, name: "Lago Vinteiro", visited: false },
                { id: 7, name: "Torre de Sinox", visited: false },
                { id: 8, name: "Boca da Mãe", visited: false }
            ],
            enemies: [
                {
                    id: 1,
                    name: "Cultista",
                    health: 8,
                    sanityDamage: 1,
                    image: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231a1a1a'/><circle cx='50' cy='40' r='20' fill='%23333'/><rect x='30' y='70' width='40' height='20' fill='%23333'/><path d='M30,40 Q50,20 70,40' fill='none' stroke='%23fff' stroke-width='2'/></svg>"
                },
                {
                    id: 2,
                    name: "Criatura da Lama",
                    health: 12,
                    sanityDamage: 2,
                    image: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231a1a1a'/><ellipse cx='50' cy='60' rx='30' ry='20' fill='%23333'/><circle cx='40' cy='40' r='5' fill='%23fff'/><circle cx='60' cy='40' r='5' fill='%23fff'/><path d='M40,50 Q50,60 60,50' fill='none' stroke='%23fff' stroke-width='2'/></svg>"
                }
            ]
        };

        // Initialize the game
        function initGame() {
            renderCharacters();
            renderMap();
            updateStatusBars();
        }

        // Render characters
        function renderCharacters() {
            const container = document.getElementById('character-display');
            container.innerHTML = '';

            gameState.characters.forEach(char => {
                const charElement = document.createElement('div');
                charElement.className = 'character bg-gray-900 p-2 rounded-lg text-center cursor-pointer';
                charElement.innerHTML = `
                    <img src="${char.image}" alt="${char.name}" class="w-16 h-16 mx-auto mb-1">
                    <h4 class="font-bold">${char.name}</h4>
                    <p class="text-xs text-gray-400">${char.description}</p>
                `;
                container.appendChild(charElement);
            });
        }

        // Render the map
        function renderMap() {
            const mapContainer = document.querySelector('.map-grid');
            mapContainer.innerHTML = '';

            // Create a 8x8 grid (for simplicity, not all tiles are used)
            for (let i = 0; i < 64; i++) {
                const tile = document.createElement('div');
                tile.className = 'map-tile';

                // Check if this tile should have a location
                const location = gameState.locations.find(loc => loc.id === i + 1);
                if (location) {
                    tile.textContent = location.id;
                    tile.title = location.name;

                    if (location.visited) {
                        tile.classList.add('visited');
                    }

                    if (location.id === gameState.currentScene) {
                        tile.classList.add('active');
                    }

                    tile.addEventListener('click', () => navigateToLocation(location.id));
                }

                mapContainer.appendChild(tile);
            }

            // Update visited locations list
            updateVisitedLocations();
        }

        // Update visited locations list
        function updateVisitedLocations() {
            const list = document.getElementById('visited-locations');
            list.innerHTML = '';

            gameState.locations
                .filter(loc => loc.visited)
                .forEach(loc => {
                    const item = document.createElement('li');
                    item.className = 'flex items-center';
                    item.innerHTML = `
                        <span class="inline-block w-4 h-4 bg-gray-700 mr-2"></span>
                        ${loc.name}
                    `;
                    list.appendChild(item);
                });
        }

        // Navigate to a location
        function navigateToLocation(locationId) {
            const location = gameState.locations.find(loc => loc.id === locationId);
            if (!location) return;

            // Mark as visited
            if (!location.visited) {
                location.visited = true;
                gameState.visitedLocations.push(location.name);
                updateVisitedLocations();
            }

            // Update current scene
            gameState.currentScene = locationId;

            // Update map highlighting
            renderMap();

            // Load scene content
            loadScene(locationId);
        }

        // Load scene content
        function loadScene(sceneId) {
            const sceneContent = document.getElementById('scene-content');

            switch (sceneId) {
                case 1:
                    sceneContent.innerHTML = `
                        <h2 class="text-2xl font-bold text-center">Cena 1 – Chegada à Cidade</h2>
                        <p class="text-justify">A van preta da SILK atravessa a última curva da estrada de terra, o motor ronronando baixo, enquanto a névoa rasteira começa a se espalhar pelos campos e pelo mato. O céu está tingido de um cinza opaco, como se a luz do crepúsculo estivesse sendo engolida pelo tempo.</p>
                        <p class="text-justify">À medida que o veículo se aproxima, a cidade surge tímida, como um segredo mal guardado. Carpa Grande parece uma relíquia esquecida, onde o tempo não passa direito. As casas rangem ao vento, e as janelas são olhos opacos que observam, mas não refletem a luz.</p>
                        
                        <div class="bg-gray-900 p-4 rounded-lg mt-4">
                            <h3 class="font-bold text-yellow-400">Sons e cheiros</h3>
                            <p>Um silêncio quase absoluto domina a rua principal — nem mesmo o canto dos grilos se faz ouvir.</p>
                            <p>O ar tem um cheiro forte de terra molhada, misturado com um odor metálico, quase de sangue oxidado.</p>
                            <p>De vez em quando, um uivo baixo corta o ar, distante, mas suficiente para arrepiar a espinha.</p>
                        </div>
                        
                        <div class="flex justify-center mt-6">
                            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='400' height='200' viewBox='0 0 400 200'><rect width='400' height='200' fill='%231a1a1a'/><path d='M50,150 L100,120 L150,140 L200,110 L250,130 L300,100 L350,150' stroke='%23666' fill='none' stroke-width='2'/><rect x='70' y='120' width='30' height='30' fill='%23333'/><rect x='170' y='90' width='30' height='50' fill='%23333'/><rect x='270' y='70' width='30' height='80' fill='%23333'/><circle cx='200' cy='50' r='20' fill='%23fff' opacity='0.2'/><path d='M50,30 L100,10 L150,40 L200,20 L250,50 L300,30 L350,60' stroke='%23666' fill='none' stroke-width='1' stroke-dasharray='5,5'/></svg>" alt="Carpa Grande" class="rounded-lg border border-gray-700">
                        </div>
                    `;
                    break;

                case 2:
                    sceneContent.innerHTML = `
                        <h2 class="text-2xl font-bold text-center">Carpa Transportes</h2>
                        <p class="text-justify">O escritório do Carpa Transportes está iluminado por uma lâmpada tremeluzente. Dentro, Mirela ajeita os papéis na mesa, seu rosto cansado mas gentil. Ela observa o grupo com um misto de curiosidade e receio.</p>
                        
                        <div class="bg-gray-900 p-4 rounded-lg mt-4">
                            <h3 class="font-bold text-yellow-400">Diálogo</h3>
                            <p class="text-red-400">Cristofer (impaciente, franzindo a testa):</p>
                            <p class="ml-4">"A gente precisa de um carro rápido. Algo que aguente essa estrada e não trave na primeira curva."</p>
                            
                            <p class="text-blue-400 mt-2">Mirela (respira fundo, tentando esconder a ansiedade):</p>
                            <p class="ml-4">"Esportivo? Vocês estão longe disso por aqui. Tenho só um Gol azul velho, mas é confiável. Querem?"</p>
                            
                            <p class="text-green-400 mt-2">Kaizer (calmo, tentando mediar):</p>
                            <p class="ml-4">"Vamos ficar com o Gol, é suficiente por enquanto. O VV vai pagar por três semanas."</p>
                            
                            <p class="mt-2">Mirela acena, mas seus olhos desviam para a janela com um leve tremor.</p>
                        </div>
                        
                        <div class="flex justify-center mt-6">
                            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'><rect width='200' height='200' fill='%23222'/><rect x='50' y='50' width='100' height='100' fill='%23333'/><rect x='70' y='70' width='20' height='20' fill='%23444'/><rect x='110' y='70' width='20' height='20' fill='%23444'/><rect x='80' y='120' width='40' height='10' fill='%23444'/><circle cx='100' cy='40' r='20' fill='%23333'/><path d='M80,30 Q100,20 120,30' fill='none' stroke='%23fff' stroke-width='2'/></svg>" alt="Mirela" class="rounded-lg border border-gray-700 w-32 h-32">
                        </div>
                    `;
                    break;

                case 3:
                    sceneContent.innerHTML = `
                        <h2 class="text-2xl font-bold text-center">Casa de Dona Iraci</h2>
                        <p class="text-justify">Vocês deixam o carro estacionado próximo à pequena praça central de Carpa Grande, onde algumas poucas árvores parecem mais secas do que vivas. O silêncio da cidade se mantém pesado, quase sufocante.</p>
                        <p class="text-justify">Ao atravessar a praça, avistam uma casa antiga, de madeira desgastada e pintura descascada. Uma senhora de cabelos grisalhos, com rosto marcado pelo tempo, está sentida na varanda. Ela observa vocês com olhos fundos e carregados de dor. Essa é Dona Iraci, uma das poucas que aceitam conversar sobre os desaparecimentos.</p>
                        
                        <div class="bg-gray-900 p-4 rounded-lg mt-4">
                            <h3 class="font-bold text-yellow-400">Diálogo</h3>
                            <p class="text-red-400">Você (VV):</p>
                            <p class="ml-4">"Boa tarde, Dona Iraci. Sou da SILK. Viemos ajudar com o desaparecimento do seu neto Daniel."</p>
                            
                            <p class="text-blue-400 mt-2">Dona Iraci (com voz trêmula):</p>
                            <p class="ml-4">"Ah, vocês... eu só quero encontrar meu menino. Ele sumiu no meio da noite, e ninguém viu nada. Só... aquelas marcas, o sangue, o cheiro."</p>
                            <p class="ml-4">Ela segura um amuleto feito de ossos pequenos, quase desfeitos pelo tempo.</p>
                            
                            <p class="text-green-400 mt-2">Kaizer (observando atentamente):</p>
                            <p class="ml-4">"Esse amuleto... é um talismã contra possessões, certo? Como conseguiu?"</p>
                            
                            <p class="text-blue-400 mt-2">Dona Iraci:</p>
                            <p class="ml-4">"Meu avô me passou, dizia que protegeria contra o que vive na escuridão da floresta."</p>
                        </div>
                        
                        <div class="flex justify-center mt-6">
                            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'><rect width='200' height='200' fill='%23222'/><circle cx='100' cy='60' r='30' fill='%23333'/><path d='M70,100 Q100,150 130,100' fill='%23333'/><path d='M80,50 Q90,40 100,45 Q110,40 120,50' fill='none' stroke='%23fff' stroke-width='2'/><line x1='80' y1='80' x2='70' y2='70' stroke='%23fff' stroke-width='2'/><line x1='120' y1='80' x2='130' y2='70' stroke='%23fff' stroke-width='2'/></svg>" alt="Dona Iraci" class="rounded-lg border border-gray-700 w-32 h-32">
                        </div>
                    `;
                    break;

                case 4:
                    sceneContent.innerHTML = `
                        <h2 class="text-2xl font-bold text-center">Casa da Colina</h2>
                        <p class="text-justify">Vocês seguem as coordenadas dadas por Dona Iraci e chegam a uma construção isolada, encoberta por árvores retorcidas e coberta de musgo. A casa parece abandonada, mas sinais de presença recente são evidentes: pegadas na lama, marcas de unhas nas janelas.</p>
                        <p class="text-justify">O ambiente é pesado, o ar denso de umidade e algo indefinido — medo, talvez.</p>
                        
                        <div class="bg-gray-900 p-4 rounded-lg mt-4">
                            <h3 class="font-bold text-yellow-400">Exploração</h3>
                            <p>Vocês vasculham o interior com lanternas, encontrando móveis cobertos de poeira, retratos antigos com rostos apagados, e paredes marcadas com símbolos em latim. Entre os escombros, um livro quase destruído chama atenção: é o diário queimado do padre Vivaldi.</p>
                        </div>
                        
                        <div class="flex justify-center mt-6">
                            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='200' viewBox='0 0 300 200'><rect width='300' height='200' fill='%231a1a1a'/><rect x='50' y='50' width='200' height='150' fill='%23333'/><rect x='70' y='70' width='40' height='30' fill='%23444'/><rect x='130' y='70' width='40' height='30' fill='%23444'/><rect x='190' y='70' width='40' height='30' fill='%23444'/><rect x='70' y='120' width='40' height='30' fill='%23444'/><rect x='130' y='120' width='40' height='30' fill='%23444'/><rect x='190' y='120' width='40' height='30' fill='%23444'/><path d='M50,50 L150,20 L250,50' fill='none' stroke='%23666' stroke-width='2'/></svg>" alt="Casa da Colina" class="rounded-lg border border-gray-700">
                        </div>
                    `;
                    break;

                case 5:
                    sceneContent.innerHTML = `
                        <h2 class="text-2xl font-bold text-center">Orfanato Limoeiro Podre</h2>
                        <p class="text-justify">Após a descoberta na Casa da Colina, o grupo se dirige ao Orfanato Limoeiro Podre — um prédio antigo, com janelas quebradas e portas rangendo, situado na periferia da cidade. Dizem que, quando o orfanato fechou, crianças começaram a desaparecer, e vozes sussurrantes ecoam à noite.</p>
                        
                        <div class="bg-gray-900 p-4 rounded-lg mt-4">
                            <h3 class="font-bold text-yellow-400">Entrada e Atmosfera</h3>
                            <p>O céu está nublado, com nuvens pesadas, e o vento carrega um cheiro de podridão misturado a terra úmida. Vocês sentem que a energia ali está desequilibrada, e o medo é quase palpável.</p>
                            
                            <h3 class="font-bold text-yellow-400 mt-4">Enigma da Canção</h3>
                            <p>Dentro do orfanato, ecoa uma canção infantil — uma melodia distorcida e inquietante, que parece vir de lugar nenhum e de todos ao mesmo tempo.</p>
                        </div>
                        
                        <div class="flex justify-center mt-6">
                            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='200' viewBox='0 0 300 200'><rect width='300' height='200' fill='%231a1a1a'/><rect x='50' y='50' width='200' height='150' fill='%23333'/><rect x='70' y='70' width='30' height='30' fill='%23444'/><rect x='120' y='70' width='30' height='30' fill='%23444'/><rect x='170' y='70' width='30' height='30' fill='%23444'/><rect x='70' y='120' width='30' height='30' fill='%23444'/><rect x='120' y='120' width='30' height='30' fill='%23444'/><rect x='170' y='120' width='30' height='30' fill='%23444'/><path d='M50,50 L150,30 L250,50' fill='none' stroke='%23666' stroke-width='2'/></svg>" alt="Orfanato Limoeiro Podre" class="rounded-lg border border-gray-700">
                        </div>
                    `;
                    break;

                case 6:
                    sceneContent.innerHTML = `
                        <h2 class="text-2xl font-bold text-center">Lago Vinteiro</h2>
                        <p class="text-justify">O grupo se aproxima do Lago Vinteiro, uma área pantanosa onde se acredita haver uma antiga plataforma usada para rituais aquáticos. A névoa é ainda mais densa, e a água parece quase negra sob a pouca luz.</p>
                        
                        <div class="bg-gray-900 p-4 rounded-lg mt-4">
                            <h3 class="font-bold text-yellow-400">Plataforma no Meio do Lago</h3>
                            <p>No centro do lago, uma plataforma de pedra emerge, com um altar coberto de musgo e inscrições misteriosas.</p>
                        </div>
                        
                        <div class="flex justify-center mt-6">
                            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='200' viewBox='0 0 300 200'><rect width='300' height='200' fill='%231a1a1a'/><ellipse cx='150' cy='150' rx='100' ry='30' fill='%23222'/><circle cx='150' cy='100' r='30' fill='%23333'/><rect x='135' y='70' width='30' height='30' fill='%23444'/><path d='M120,100 L135,85 M180,100 L165,85' stroke='%23fff' stroke-width='2'/></svg>" alt="Lago Vinteiro" class="rounded-lg border border-gray-700">
                        </div>
                    `;
                    break;

                case 7:
                    sceneContent.innerHTML = `
                        <h2 class="text-2xl font-bold text-center">Torre de Sinox</h2>
                        <p class="text-justify">Vocês chegam à Torre de Sinox ao entardecer. A torre, uma construção de pedra antiga e meio em ruínas, está coberta por trepadeiras negras que parecem pulsar levemente, como se estivessem vivas. O ar ao redor é denso, carregado de uma energia invisível, e uma névoa fina se eleva do solo.</p>
                        <p class="text-justify">O caminho até a entrada é cheio de símbolos entalhados nas pedras, muitos deles parecidos com os que viram na galeria sob o cemitério. É como se a torre fosse um nó de energia espiritual, um lugar de poder ancestral.</p>
                        
                        <div class="bg-gray-900 p-4 rounded-lg mt-4">
                            <h3 class="font-bold text-yellow-400">Quebra-Cabeça na Torre</h3>
                            <p>Dentro, o ambiente é escuro e silencioso, exceto pelo som de gotas caindo ao longe. Na parede principal do salão, um enorme mural contém símbolos complexos e padrões que formam um enigma visual. A "Chave das Águas", artefato necessário para abrir portais entre dimensões aquáticas, está guardada em um compartimento trancado, protegido por um mecanismo arcano que só é desbloqueado resolvendo o enigma.</p>
                        </div>
                        
                        <div class="flex justify-center mt-6">
                            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='300' viewBox='0 0 200 300'><rect width='200' height='300' fill='%231a1a1a'/><rect x='50' y='50' width='100' height='200' fill='%23333'/><rect x='70' y='70' width='60' height='60' fill='%23444'/><rect x='70' y='150' width='60' height='60' fill='%23444'/><path d='M50,50 L100,20 L150,50' fill='none' stroke='%23666' stroke-width='2'/></svg>" alt="Torre de Sinox" class="rounded-lg border border-gray-700 h-48">
                        </div>
                    `;
                    break;

                case 8:
                    sceneContent.innerHTML = `
                        <h2 class="text-2xl font-bold text-center">Boca da Mãe</h2>
                        <p class="text-justify">Vocês chegam à clareira mais profunda da Floresta Maldita — um espaço onde o tempo parece dilatado e o ar é quase sólido, carregado de uma energia opressora. O solo está coberto por raízes pulsantes e o céu acima é um redemoinho cinza escuro, como se a própria realidade estivesse prestes a se romper.</p>
                        <p class="text-justify">No centro, um altar de pedra negra em formato de boca aberta — a "Boca da Mãe". Cultistas encapuzados cercam o espaço, murmurando cânticos em uma língua que arrepia a pele. Uma criança — o "Filho Nascido Errado" — está amarrada ao altar, imóvel e pálida, mas com olhos que brilham em vermelho sobrenatural.</p>
                        
                        <div class="bg-gray-900 p-4 rounded-lg mt-4">
                            <h3 class="font-bold text-yellow-400">Escolha do Jogador</h3>
                            <p>Você e seus aliados precisam agir rápido. As opções são:</p>
                            <ul class="list-disc pl-5 mt-2 space-y-1">
                                <li>Invadir o Ritual: Atacar de surpresa os cultistas e tentar libertar a criança.</li>
                                <li>Canalizar os Artefatos: Usar a Chave das Águas, o Amuleto de Daniel e o elixir encontrado para tentar conter o ritual.</li>
                                <li>Aceitar o Pacto: Tentar negociar com Ia-Merkha, buscando uma trégua ou um poder compartilhado — uma escolha perigosa e ambígua.</li>
                            </ul>
                        </div>
                        
                        <div class="flex justify-center mt-6">
                            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='200' viewBox='0 0 300 200'><rect width='300' height='200' fill='%231a1a1a'/><path d='M50,150 Q150,200 250,150 Q200,100 150,50 Q100,100 50,150' fill='%23333'/><circle cx='150' cy='120' r='20' fill='%23444'/><path d='M140,110 L150,120 L160,110' fill='none' stroke='%23fff' stroke-width='2'/><circle cx='130' cy='130' r='5' fill='%23f00'/><circle cx='170' cy='130' r='5' fill='%23f00'/></svg>" alt="Boca da Mãe" class="rounded-lg border border-gray-700">
                        </div>
                    `;
                    break;

                default:
                    sceneContent.innerHTML = `<p class="text-center">Cena não implementada ainda.</p>`;
            }

            // Update action buttons based on scene
            updateActionButtons(sceneId);
        }

        // Update action buttons based on scene
        function updateActionButtons(sceneId) {
            const actionButtons = document.getElementById('action-buttons');
            const dialogOptions = document.getElementById('dialog-options');

            // Clear previous options
            dialogOptions.innerHTML = '';
            dialogOptions.classList.add('hidden');

            // Show different buttons based on scene
            switch (sceneId) {
                case 1:
                    actionButtons.innerHTML = `
                        <button class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition" onclick="showPerceptionTest()">Teste de Percepção</button>
                        <button class="bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition" onclick="continueStory()">Continuar</button>
                    `;
                    break;

                case 2:
                    actionButtons.innerHTML = `
                        <button class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition" onclick="showDialogOptions(['Perguntar sobre os desaparecimentos', 'Negociar o preço do carro', 'Observar o ambiente'])">Interagir</button>
                        <button class="bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition" onclick="continueStory()">Continuar</button>
                    `;
                    break;

                case 3:
                    actionButtons.innerHTML = `
                        <button class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition" onclick="showPersuasionTest()">Teste de Persuasão</button>
                        <button class="bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition" onclick="continueStory()">Continuar</button>
                    `;
                    break;

                case 4:
                    actionButtons.innerHTML = `
                        <button class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition" onclick="showInvestigationTest()">Teste de Investigação</button>
                        <button class="bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition" onclick="continueStory()">Continuar</button>
                    `;
                    break;

                case 5:
                    actionButtons.innerHTML = `
                        <button class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition" onclick="showCourageTest()">Teste de Coragem</button>
                        <button class="bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition" onclick="continueStory()">Continuar</button>
                    `;
                    break;

                case 6:
                    actionButtons.innerHTML = `
                        <button class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition" onclick="showDexterityTest()">Teste de Destreza</button>
                        <button class="bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition" onclick="continueStory()">Continuar</button>
                    `;
                    break;

                case 7:
                    actionButtons.innerHTML = `
                        <button class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition" onclick="showIntelligenceTest()">Teste de Inteligência</button>
                        <button class="bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition" onclick="continueStory()">Continuar</button>
                    `;
                    break;

                case 8:
                    actionButtons.innerHTML = `
                        <button class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition" onclick="showFinalChoice()">Escolha Final</button>
                        <button class="bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition" onclick="continueStory()">Continuar</button>
                    `;
                    break;

                default:
                    actionButtons.innerHTML = `
                        <button class="bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition" onclick="continueStory()">Continuar</button>
                    `;
            }
        }

        // Continue the story
        function continueStory() {
            if (gameState.currentScene < 8) {
                gameState.currentScene++;
                navigateToLocation(gameState.currentScene);
            } else {
                // Game is complete
                document.getElementById('scene-content').innerHTML = `
                    <h2 class="text-2xl font-bold text-center">Fim da Jornada</h2>
                    <p class="text-justify">Vocês completaram sua missão em Carpa Grande. A cidade pode finalmente respirar aliviada, mas a sensação de vigilância nunca desaparece totalmente. A SILK continuará monitorando a região, pronta para agir se os horrores retornarem.</p>
                    <div class="flex justify-center mt-6">
                        <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='200' viewBox='0 0 300 200'><rect width='300' height='200' fill='%231a1a1a'/><path d='M50,150 L100,120 L150,140 L200,110 L250,130 L300,100 L350,150' stroke='%23666' fill='none' stroke-width='2'/><rect x='70' y='120' width='30' height='30' fill='%23333'/><rect x='170' y='90' width='30' height='50' fill='%23333'/><rect x='270' y='70' width='30' height='80' fill='%23333'/><circle cx='200' cy='50' r='20' fill='%23fff' opacity='0.5'/></svg>" alt="Carpa Grande" class="rounded-lg border border-gray-700">
                    </div>
                    <div class="text-center mt-8">
                        <button onclick="resetGame()" class="bg-red-800 hover:bg-red-700 text-white px-6 py-3 rounded-lg text-lg font-bold transition">Jogar Novamente</button>
                    </div>
                `;

                document.getElementById('action-buttons').innerHTML = '';
            }
        }

        // Reset the game
        function resetGame() {
            gameState.currentScene = 1;
            gameState.health = 100;
            gameState.sanity = 100;
            gameState.inventory = [];
            gameState.visitedLocations = [];
            gameState.testInProgress = false;
            gameState.currentTest = null;
            gameState.diceRoll = 0;

            // Reset locations
            gameState.locations.forEach(loc => loc.visited = false);
            gameState.locations[0].visited = true; // Starting location

            // Update UI
            updateStatusBars();
            renderMap();
            loadScene(1);
            updateActionButtons(1);
        }

        // Show dialog options
        function showDialogOptions(options) {
            const dialogOptions = document.getElementById('dialog-options');
            dialogOptions.innerHTML = '';

            options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition w-full text-left';
                button.textContent = option;
                button.addEventListener('click', () => selectDialogOption(index));
                dialogOptions.appendChild(button);
            });

            dialogOptions.classList.remove('hidden');
        }

        // Select dialog option
        function selectDialogOption(index) {
            const dialogOptions = document.getElementById('dialog-options');
            dialogOptions.classList.add('hidden');

            // Process the selected option
            const sceneContent = document.getElementById('scene-content');
            const newContent = document.createElement('div');
            newContent.className = 'bg-gray-900 p-4 rounded-lg mt-4';

            switch (gameState.currentScene) {
                case 2: // Carpa Transportes
                    switch (index) {
                        case 0: // Perguntar sobre os desaparecimentos
                            newContent.innerHTML = `
                                <h3 class="font-bold text-yellow-400">Perguntar sobre os desaparecimentos</h3>
                                <p class="text-blue-400">Mirela:</p>
                                <p class="ml-4">"As pessoas aqui não gostam de falar sobre isso... mas sim, muitos desapareceram. Sempre à noite, sempre sem deixar rastro. Exceto... aquelas marcas estranhas no chão."</p>
                                <p class="mt-2">Você ganha +1 ponto de informação sobre os desaparecimentos.</p>
                            `;
                            break;

                        case 1: // Negociar o preço do carro
                            newContent.innerHTML = `
                                <h3 class="font-bold text-yellow-400">Negociar o preço do carro</h3>
                                <p class="text-blue-400">Mirela:</p>
                                <p class="ml-4">"Não há muito o que negociar... mas se vocês prometerem ajudar a encontrar meu irmão, posso fazer um desconto."</p>
                                <p class="mt-2">Você concorda e ganha 10% de desconto no aluguel do carro.</p>
                            `;
                            break;

                        case 2: // Observar o ambiente
                            newContent.innerHTML = `
                                <h3 class="font-bold text-yellow-400">Observar o ambiente</h3>
                                <p>Você nota que Mirela parece nervosa, seus olhos frequentemente se voltam para uma foto em sua mesa — um homem jovem, provavelmente seu irmão desaparecido.</p>
                                <p class="mt-2">No canto da sala, há um pequeno altar com velas e um objeto estranho que parece feito de ossos.</p>
                            `;
                            break;
                    }
                    break;

                // Add more dialog options for other scenes as needed
            }

            sceneContent.appendChild(newContent);
        }

        // Show perception test
        function showPerceptionTest() {
            gameState.currentTest = {
                type: 'perception',
                difficulty: 12,
                success: 'Você compartilha suas observações com Cristofer e Kaizer, ajudando o grupo a se preparar para o que está por vir — mais cautela, armas prontas, e foco redobrado.',
                failure: 'Você ignora esses sinais, subestimando o ambiente. O grupo fica vulnerável a surpresas e armadilhas nas próximas cenas.'
            };

            showTestDialog('Teste de Percepção (CD 12)', 'O que você nota?', [
                'Pequenas sombras que parecem dançar entre as casas, desaparecendo quando você olha diretamente.',
                'Símbolos antigos, riscados em paredes e postes — alguns deles com inscrições em latim, outros em uma língua desconhecida.',
                'Um odor metálico, semelhante a ferro queimado, que vem do lado da floresta, misturado ao cheiro de mofo e folhas mortas.'
            ]);
        }

        // Show persuasion test
        function showPersuasionTest() {
            gameState.currentTest = {
                type: 'persuasion',
                difficulty: 13,
                success: 'Dona Iraci se abre, entrega o diário antigo do padre Vivaldi, que tinha estudado a história do culto local. Também fornece pistas para uma antiga construção chamada "Casa da Colina".',
                failure: 'Ela fecha-se, desconfiada, desconfortável. Dificulta o acesso a informações, e talvez alerte os cultistas sobre a investigação.'
            };

            showTestDialog('Teste de Persuasão (CD 13)', 'Tente convencer Dona Iraci a compartilhar informações:', [
                'Mostrar sua identificação da SILK e prometer ajuda profissional.',
                'Compartilhar uma história pessoal de perda para criar empatia.',
                'Oferecer proteção em troca das informações.'
            ]);
        }

        // Show investigation test
        function showInvestigationTest() {
            gameState.currentTest = {
                type: 'investigation',
                difficulty: 15,
                success: 'Descobrem uma passagem secreta sob o assoalho, levando a um porão com artefatos rituais e inscrições que indicam a localização de um "Templo Submerso".',
                failure: 'Ativam, sem querer, uma armadilha espiritual que causa um ataque mental — perda de sanidade temporária, alucinações e uma sensação de que algo os observa.'
            };

            showTestDialog('Teste de Investigação (CD 15)', 'Tente decifrar as páginas queimadas:', [
                'Focar nas ilustrações e símbolos visíveis.',
                'Tentar reconstruir o texto a partir dos fragmentos legíveis.',
                'Usar luz ultravioleta para revelar escritos ocultos.'
            ]);
        }

        // Show courage test
        function showCourageTest() {
            gameState.currentTest = {
                type: 'courage',
                difficulty: 14,
                success: 'Entra com firmeza, encontrando uma sala secreta cheia de símbolos e um antigo diário de uma das crianças desaparecidas, com anotações enigmáticas.',
                failure: 'O medo toma conta; ao entrar, vozes infantis perturbadoras e sombras surgem, causando ferimentos físicos e psicológicos.'
            };

            showTestDialog('Teste de Coragem (CD 14)', 'Como você entra no orfanato?', [
                'Determinado, com arma em punho e lanterna acesa.',
                'Cauteloso, verificando cada canto antes de avançar.',
                'Rapidamente, tentando surpreender qualquer ameaça.'
            ]);
        }

        // Show dexterity test
        function showDexterityTest() {
            gameState.currentTest = {
                type: 'dexterity',
                difficulty: 15,
                success: 'Atravessam em silêncio e descobrem uma escada secreta que leva a um templo submerso.',
                failure: 'O barulho desperta uma criatura da lama, que os ataca, causando ferimentos e aumentando a tensão.'
            };

            showTestDialog('Teste de Destreza (CD 15)', 'Como atravessar o lago?', [
                'Usar cordas para criar uma passagem segura entre as pedras.',
                'Mover-se lentamente, testando cada passo antes de colocar o peso.',
                'Distrair possíveis ameaças antes de atravessar.'
            ]);
        }

        // Show intelligence test
        function showIntelligenceTest() {
            gameState.currentTest = {
                type: 'intelligence',
                difficulty: 18,
                success: 'Ao alinhar os painéis corretamente, uma luz azulada emerge, o mecanismo se destrava e o compartimento se abre, revelando a Chave das Águas.',
                failure: 'O enigma ativa um alarme místico. Um grupo de entidades aquáticas etéreas surge, atacando e causando dano psicológico e físico.'
            };

            showTestDialog('Teste de Inteligência (CD 18)', 'Como resolver o enigma?', [
                'Seguir a lógica do fluxo da água e movimento constante.',
                'Tentar combinar símbolos que representem elementos aquáticos.',
                'Observar padrões matemáticos nas runas.'
            ]);
        }

        // Show final choice
        function showFinalChoice() {
            gameState.currentTest = {
                type: 'final',
                difficulty: 18,
                success: 'O ritual é selado. A criança é salva, o culto disperso, e a cidade recebe um alívio temporário, embora o mal possa ainda espreitar nas sombras.',
                failure: 'A Mãe desperta. A cidade é engolida e a corrupção se espalha pelo mundo. Vocês tornam-se fugitivos, caçados pelo culto e pelas forças sombrias.'
            };

            showTestDialog('Escolha Final (CD 18)', 'Qual será sua decisão?', [
                'Destruir o artefato e acabar com o ritual.',
                'Usar o artefato para tentar controlar Ia-Merkha.',
                'Aceitar o pacto proposto por Érico e se unir ao culto.'
            ]);
        }

        // Show test dialog
        function showTestDialog(title, question, options) {
            const sceneContent = document.getElementById('scene-content');
            const testDialog = document.createElement('div');
            testDialog.className = 'bg-gray-900 p-4 rounded-lg mt-4';
            testDialog.innerHTML = `
                <h3 class="font-bold text-yellow-400">${title}</h3>
                <p class="mt-2">${question}</p>
                <div class="mt-4 space-y-2" id="test-options">
                    ${options.map((opt, i) => `
                        <button onclick="selectTestOption(${i})" class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded transition w-full text-left">${opt}</button>
                    `).join('')}
                </div>
            `;

            sceneContent.appendChild(testDialog);
            document.getElementById('action-buttons').innerHTML = '';
        }

        // Select test option
        function selectTestOption(index) {
            // Show dice roll UI
            document.getElementById('dice-roll').classList.remove('hidden');
            document.getElementById('roll-result').textContent = '';
            document.getElementById('continue-after-roll').classList.add('hidden');

            // Store selected option
            gameState.testOption = index;
        }

        // Roll dice
        function rollDice() {
            if (gameState.testInProgress) return;

            gameState.testInProgress = true;
            const dice = document.getElementById('dice');
            const rollResult = document.getElementById('roll-result');

            // Animate dice roll
            let rolls = 0;
            const maxRolls = 10;
            const rollInterval = setInterval(() => {
                rolls++;
                const randomValue = Math.floor(Math.random() * 6) + 1;
                dice.textContent = randomValue;

                if (rolls >= maxRolls) {
                    clearInterval(rollInterval);
                    finishRoll();
                }
            }, 100);

            function finishRoll() {
                // Get final roll (d20 for tests)
                const finalRoll = Math.floor(Math.random() * 20) + 1;
                gameState.diceRoll = finalRoll;

                // Show result
                dice.textContent = finalRoll;
                rollResult.textContent = `Você rolou um ${finalRoll}!`;

                // Show continue button
                document.getElementById('continue-after-roll').classList.remove('hidden');

                gameState.testInProgress = false;
            }
        }

        // Process roll result
        function processRollResult() {
            const diceRoll = gameState.diceRoll;
            const test = gameState.currentTest;
            const sceneContent = document.getElementById('scene-content');

            // Hide dice roll UI
            document.getElementById('dice-roll').classList.add('hidden');

            // Check if roll succeeds
            const success = diceRoll >= test.difficulty;
            const resultDiv = document.createElement('div');
            resultDiv.className = 'bg-gray-900 p-4 rounded-lg mt-4';

            if (success) {
                resultDiv.innerHTML = `
                    <h3 class="font-bold text-green-500">Sucesso!</h3>
                    <p>${test.success}</p>
                `;

                // Add items or benefits for success
                if (test.type === 'persuasion') {
                    addToInventory('Diário do Padre Vivaldi');
                    addToInventory('Mapa da Casa da Colina');
                } else if (test.type === 'investigation') {
                    addToInventory('Mapa do Templo Submerso');
                }
            } else {
                resultDiv.innerHTML = `
                    <h3 class="font-bold text-red-500">Falha!</h3>
                    <p>${test.failure}</p>
                `;

                // Apply penalties for failure
                if (test.type === 'investigation') {
                    updateSanity(-15);
                } else if (test.type === 'courage') {
                    updateHealth(-10);
                    updateSanity(-10);
                }
            }

            sceneContent.appendChild(resultDiv);

            // Show continue button
            document.getElementById('action-buttons').innerHTML = `
                <button class="bg-blue-900 hover:bg-blue-800 text-white px-4 py-2 rounded transition" onclick="continueStory()">Continuar</button>
            `;
        }

        // Add item to inventory
        function addToInventory(itemName) {
            if (!gameState.inventory.includes(itemName)) {
                gameState.inventory.push(itemName);
                updateInventoryDisplay();
            }
        }

        // Update inventory display
        function updateInventoryDisplay() {
            const inventoryItems = document.getElementById('inventory-items');
            inventoryItems.innerHTML = '';

            gameState.inventory.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'flex items-center justify-between bg-gray-800 p-2 rounded';
                itemElement.innerHTML = `
                    <span>${item}</span>
                    <button onclick="useItem('${item}')" class="bg-blue-900 hover:bg-blue-800 text-white px-2 py-1 rounded text-xs">Usar</button>
                `;
                inventoryItems.appendChild(itemElement);
            });
        }

        // Use item
        function useItem(itemName) {
            alert(`Você usou ${itemName}!`);
            // Add specific item effects here
        }

        // Toggle inventory
        function toggleInventory() {
            const modal = document.getElementById('inventory-modal');
            modal.classList.toggle('hidden');
        }

        // Update health
        function updateHealth(amount) {
            gameState.health = Math.max(0, Math.min(gameState.maxHealth, gameState.health + amount));
            updateStatusBars();

            if (gameState.health <= 0) {
                gameOver();
            }
        }

        // Update sanity
        function updateSanity(amount) {
            gameState.sanity = Math.max(0, Math.min(gameState.maxSanity, gameState.sanity + amount));
            updateStatusBars();

            if (gameState.sanity <= 0) {
                gameOver();
            }
        }

        // Update status bars
        function updateStatusBars() {
            document.getElementById('health-bar').style.width = `${gameState.health}%`;
            document.getElementById('sanity-bar').style.width = `${gameState.sanity}%`;
        }

        // Game over
        function gameOver() {
            document.getElementById('scene-content').innerHTML = `
                <h2 class="text-2xl font-bold text-center text-red-600">Fim de Jogo</h2>
                <p class="text-justify">${gameState.health <= 0 ?
                    'Você sucumbiu aos ferimentos. As sombras de Carpa Grande reclamam mais uma vítima.' :
                    'Sua mente se quebrou diante dos horrores. Você agora é parte do pesadelo que tentou combater.'}
                </p>
                <div class="flex justify-center mt-6">
                    <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='200' viewBox='0 0 300 200'><rect width='300' height='200' fill='%231a1a1a'/><path d='M50,50 L250,150 M50,150 L250,50' stroke='%23f00' stroke-width='4'/><circle cx='150' cy='100' r='40' fill='%231a1a1a' stroke='%23f00' stroke-width='2'/></svg>" alt="Game Over" class="rounded-lg border border-gray-700">
                </div>
                <div class="text-center mt-8">
                    <button onclick="resetGame()" class="bg-red-800 hover:bg-red-700 text-white px-6 py-3 rounded-lg text-lg font-bold transition">Tentar Novamente</button>
                </div>
            `;

            document.getElementById('action-buttons').innerHTML = '';
        }

        // Initialize the game when page loads
        window.onload = initGame;
    </script>
</body>

</html>
